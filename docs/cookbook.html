<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOON Cookbook - simple_toon</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <div class="logo-container">
            <img src="images/logo.png" alt="simple_* logo" class="logo">
        </div>
        <h1>TOON Cookbook</h1>
        <p class="tagline">Real-World Recipes and Complex Examples</p>
    </header>

    <nav>
        <ul>
            <li><a href="index.html">Overview</a></li>
            <li><a href="#format-guide">Format Guide</a></li>
            <li><a href="#builder-api">Builder API</a></li>
            <li><a href="#complex-examples">Complex Examples</a></li>
            <li><a href="#edge-cases">Edge Cases</a></li>
            <li><a href="https://github.com/simple-eiffel/simple_toon">GitHub</a></li>
        </ul>
    </nav>

    <main>
        <section id="format-guide">
            <h2>TOON Format Guide</h2>

            <h3>Understanding Array Types</h3>
            <p>TOON has two distinct array formats, each optimized for different data shapes:</p>

            <div class="feature-grid">
                <div class="feature-card">
                    <h4>Numbered Lists (Scalar Arrays)</h4>
                    <p>For simple arrays of primitive values:</p>
<pre><code>-- Simple string array
tags[3]: red,green,blue

-- Integer array
scores[5]: 95,87,92,78,88

-- Mixed but simple values
flags[4]: true,false,true,null</code></pre>
                    <p><strong>When to use:</strong> Arrays of strings, numbers, or booleans without nested structure.</p>
                </div>

                <div class="feature-card">
                    <h4>Tabular Arrays (Object Arrays)</h4>
                    <p>For arrays of uniform objects with named columns:</p>
<pre><code>-- Array of product objects
products[3]{sku,name,price}:
  SKU001,Widget,9.99
  SKU002,Gadget,19.99
  SKU003,Gizmo,4.99</code></pre>
                    <p><strong>When to use:</strong> Arrays where each element is an object with the same keys. Compresses repeated key names into a single header.</p>
                </div>
            </div>

            <h3>Key Differences</h3>
            <table>
                <tr>
                    <th>Feature</th>
                    <th>Numbered List</th>
                    <th>Tabular Array</th>
                </tr>
                <tr>
                    <td>Format</td>
                    <td><code>key[n]: val1,val2,val3</code></td>
                    <td><code>key[n]{col1,col2}:</code> + rows</td>
                </tr>
                <tr>
                    <td>Element Type</td>
                    <td>Scalars (string, number, boolean, null)</td>
                    <td>Objects with uniform keys</td>
                </tr>
                <tr>
                    <td>Token Savings</td>
                    <td>~20-30%</td>
                    <td>~50-60%</td>
                </tr>
                <tr>
                    <td>Best For</td>
                    <td>tags, IDs, flags</td>
                    <td>records, rows, items</td>
                </tr>
            </table>
        </section>

        <section id="builder-api">
            <h2>TOON_BUILDER: Direct Construction</h2>
            <p>Build TOON directly without creating JSON first:</p>

            <h3>Basic Usage</h3>
<pre><code><span class="keyword">local</span>
    builder: <span class="type">TOON_BUILDER</span>
    result: <span class="type">STRING_32</span>
<span class="keyword">do</span>
    <span class="keyword">create</span> builder.make
    result := builder
        .add_string (<span class="string">"name"</span>, <span class="string">"Alice"</span>)
        .add_integer (<span class="string">"age"</span>, 30)
        .add_boolean (<span class="string">"active"</span>, True)
        .to_string

    <span class="comment">-- Result:</span>
    <span class="comment">-- name: Alice</span>
    <span class="comment">-- age: 30</span>
    <span class="comment">-- active: true</span>
<span class="keyword">end</span></code></pre>

            <h3>Tabular Arrays</h3>
<pre><code>result := builder
    .start_array (<span class="string">"items"</span>, &lt;&lt;<span class="string">"sku"</span>, <span class="string">"qty"</span>, <span class="string">"price"</span>&gt;&gt;)
        .row (&lt;&lt;<span class="string">"A1"</span>, <span class="string">"10"</span>, <span class="string">"9.99"</span>&gt;&gt;)
        .row (&lt;&lt;<span class="string">"B2"</span>, <span class="string">"5"</span>, <span class="string">"19.99"</span>&gt;&gt;)
    .end_array
    .to_string

<span class="comment">-- Result:</span>
<span class="comment">-- items[2]{sku,qty,price}:</span>
<span class="comment">--   A1,10,9.99</span>
<span class="comment">--   B2,5,19.99</span></code></pre>

            <h3>Nested Objects</h3>
<pre><code>result := builder
    .add_string (<span class="string">"type"</span>, <span class="string">"customer"</span>)
    .start_object (<span class="string">"address"</span>)
        .add_string (<span class="string">"street"</span>, <span class="string">"123 Main St"</span>)
        .add_string (<span class="string">"city"</span>, <span class="string">"NYC"</span>)
        .add_string (<span class="string">"zip"</span>, <span class="string">"10001"</span>)
    .end_object
    .to_string

<span class="comment">-- Result:</span>
<span class="comment">-- type: customer</span>
<span class="comment">-- address:</span>
<span class="comment">--   street: 123 Main St</span>
<span class="comment">--   city: NYC</span>
<span class="comment">--   zip: 10001</span></code></pre>

            <h3>Simple Arrays</h3>
<pre><code>result := builder
    .add_string_array (<span class="string">"tags"</span>, &lt;&lt;<span class="string">"urgent"</span>, <span class="string">"review"</span>, <span class="string">"pending"</span>&gt;&gt;)
    .add_integer_array (<span class="string">"ids"</span>, &lt;&lt;101, 102, 103&gt;&gt;)
    .to_string

<span class="comment">-- Result:</span>
<span class="comment">-- tags[3]: urgent,review,pending</span>
<span class="comment">-- ids[3]: 101,102,103</span></code></pre>
        </section>

        <section id="complex-examples">
            <h2>Complex Real-World Examples</h2>

            <h3>E-Commerce Order</h3>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>JSON (142 tokens)</h4>
<pre><code>{
  "order_id": "ORD-12345",
  "customer": {
    "name": "Alice Smith",
    "email": "alice@example.com"
  },
  "items": [
    {"sku": "SKU001", "name": "Widget", "qty": 2, "price": 9.99},
    {"sku": "SKU002", "name": "Gadget", "qty": 1, "price": 19.99},
    {"sku": "SKU003", "name": "Gizmo", "qty": 5, "price": 4.99}
  ],
  "total": 64.92,
  "shipped": false
}</code></pre>
                </div>

                <div class="feature-card">
                    <h4>TOON (58 tokens, 59% reduction)</h4>
<pre><code>order_id: ORD-12345
customer:
  name: Alice Smith
  email: alice@example.com
items[3]{sku,name,qty,price}:
  SKU001,Widget,2,9.99
  SKU002,Gadget,1,19.99
  SKU003,Gizmo,5,4.99
total: 64.92
shipped: false</code></pre>
                </div>
            </div>

            <h3>API Response with Pagination</h3>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>JSON</h4>
<pre><code>{
  "data": [
    {"id": 1, "name": "Alice", "role": "admin"},
    {"id": 2, "name": "Bob", "role": "user"},
    {"id": 3, "name": "Carol", "role": "user"}
  ],
  "pagination": {
    "page": 1,
    "per_page": 10,
    "total": 3,
    "pages": 1
  }
}</code></pre>
                </div>

                <div class="feature-card">
                    <h4>TOON</h4>
<pre><code>data[3]{id,name,role}:
  1,Alice,admin
  2,Bob,user
  3,Carol,user
pagination:
  page: 1
  per_page: 10
  total: 3
  pages: 1</code></pre>
                </div>
            </div>

            <h3>Configuration File</h3>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>JSON</h4>
<pre><code>{
  "server": {
    "host": "localhost",
    "port": 8080,
    "ssl": true
  },
  "database": {
    "driver": "postgresql",
    "host": "db.example.com",
    "port": 5432,
    "name": "myapp"
  },
  "features": ["auth", "cache", "logging"]
}</code></pre>
                </div>

                <div class="feature-card">
                    <h4>TOON</h4>
<pre><code>server:
  host: localhost
  port: 8080
  ssl: true
database:
  driver: postgresql
  host: db.example.com
  port: 5432
  name: myapp
features[3]: auth,cache,logging</code></pre>
                </div>
            </div>
        </section>

        <section id="edge-cases">
            <h2>Edge Cases and Special Values</h2>

            <h3>String Escaping</h3>
            <p>Strings containing special characters are automatically quoted:</p>
<pre><code><span class="comment">-- Values with colons need quoting</span>
time: "12:30:00"

<span class="comment">-- Values that look like keywords need quoting</span>
status: "true"
count: "123"

<span class="comment">-- Values with delimiters need quoting</span>
csv_row: "a,b,c"

<span class="comment">-- Values with newlines use escape sequences</span>
message: "line1\nline2"</code></pre>

            <h3>Null, Boolean, and Number Types</h3>
<pre><code><span class="comment">-- Null values</span>
optional_field: null

<span class="comment">-- Boolean values (unquoted)</span>
is_active: true
is_deleted: false

<span class="comment">-- Numbers (unquoted, exact with simple_decimal)</span>
price: 19.99
quantity: 42
scientific: 1.5e10</code></pre>

            <h3>Empty Structures</h3>
<pre><code><span class="comment">-- Empty array</span>
items[0]:

<span class="comment">-- Empty object (just the key)</span>
config:

<span class="comment">-- Empty string</span>
name: ""</code></pre>

            <h3>Non-Uniform Arrays (Not Tabular)</h3>
            <p>Arrays with different object shapes use list format:</p>
<pre><code><span class="comment">-- Objects have different keys, so not tabular</span>
events[2]:
  - type: click
    x: 100
    y: 200
  - type: scroll
    delta: 50</code></pre>
        </section>

        <section id="best-practices">
            <h2>Best Practices</h2>

            <h3>When to Use TOON</h3>
            <ul>
                <li><strong>LLM Prompts:</strong> Send structured data in prompts with fewer tokens</li>
                <li><strong>Uniform Object Arrays:</strong> Maximum compression for tabular data</li>
                <li><strong>Configuration:</strong> Human-readable config files</li>
                <li><strong>API Responses:</strong> Reduce payload size for LLM processing</li>
            </ul>

            <h3>When to Use JSON</h3>
            <ul>
                <li><strong>LLM Output:</strong> Most models output JSON natively</li>
                <li><strong>Deeply Nested Data:</strong> Complex nesting loses TOON benefits</li>
                <li><strong>Non-Uniform Arrays:</strong> Different object shapes don't compress</li>
                <li><strong>Interoperability:</strong> When JSON is required by external systems</li>
            </ul>

            <h3>Performance Tips</h3>
<pre><code><span class="comment">-- Check if tabular format will help</span>
<span class="keyword">if</span> toon.is_tabular_eligible (my_array) <span class="keyword">then</span>
    <span class="comment">-- Array will compress well</span>
<span class="keyword">end</span>

<span class="comment">-- Estimate token savings</span>
ratio := toon.compression_ratio (my_data)
<span class="keyword">if</span> ratio < 0.7 <span class="keyword">then</span>
    <span class="comment">-- 30%+ savings, worth using TOON</span>
<span class="keyword">end</span></code></pre>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 simple_* ecosystem. MIT License.</p>
        <p>
            <a href="https://github.com/simple-eiffel/simple_toon">GitHub</a> |
            <a href="https://simple-eiffel.github.io">Documentation</a>
        </p>
    </footer>
</body>
</html>
